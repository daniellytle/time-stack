function removeHash(){var a,b,c=window.location;"replaceState"in history?history.replaceState("",document.title,c.pathname+c.search):(a=document.body.scrollTop,b=document.body.scrollLeft,c.hash="",document.body.scrollTop=a,document.body.scrollLeft=b)}function insertAtIndex(a,b){return 0===a?void $(".todos").prepend(b):void $(".todos > div:nth-child("+(a-1)+")").after(b)}("#_=_"==location.hash||"#_=_"==location.href.slice(-1))&&removeHash();var date,picker=new Pikaday({field:document.getElementById("dateHolder"),minDate:new Date,yearRange:[(new Date).getFullYear(),2020],onSelect:function(){date=this.getMoment(),$("#datepicker").css({background:"none"}),$("#datepicker").text(this.getMoment().format("MMM DD"))}});data.todos.sort(function(a,b){return moment(a.dueDate)<moment(b.dueDate)});for(var i=data.todos.length-1;i>=0;i--){var create=moment(data.todos[i].createDate),due=moment(data.todos[i].dueDate),today=moment(),diff=due.diff(create,"days"),task=$("<div class='tOut'><div class='todo'>"+data.todos[i].name+"</div><div class='status'>"+(diff+1)+"</div><div class='icon'></div></div>");2>diff?task.addClass("urgent").children(".icon").addClass("urgPic"):4>diff?task.addClass("mild").children(".icon").addClass("mildPic"):task.addClass("fine").children(".icon").addClass("finePic"),task.appendTo(".todos").fadeIn("slow")}$("body").keydown(function(a){13==a.keyCode&&$("#goButton").click()}),$("#goButton").click(function(){if(""==$("#task").val())return void alert("please enter a task");if(void 0==date)return void alert("please enter a date");var a=moment(),b=date,c=b.diff(a,"days"),d=$("<div class='tOut'><div class='maybe todo'>"+$("#task").val()+"</div><div class='status'>"+(c+1)+"</div><div class='icon'></div></div>");2>c?d.addClass("urgent").children(".icon").addClass("urgPic"):4>c?d.addClass("mild").children(".icon").addClass("mildPic"):d.addClass("fine").children(".icon").addClass("finePic");var e;for(e=data.todos.length-1;e>-1;--e)if(moment(data.todos[e].dueDate)>b){insertAtIndex(data.todos.length-e,d);break}-1==e?data.todos.length?insertAtIndex(data.todos.length+1,d):insertAtIndex(0,d):e==data.todos.length-1&&insertAtIndex(0,d);var f={name:$("#task").val(),dueDate:b._d,createDate:moment()._d};$.post("/api",{Fbid:data.facebookId,todo:f},function(a){f._id=a,data.todos.push(f),d.children(".maybe").removeClass("maybe")})}),$(".newTop").click(function(){$("#task").focus()}),$(document).on("click",".tOut",function(){var a=0;for(a=data.todos.length-1;a>=0&&data.todos[a].name!=$(this).children(".todo").text();a--);var b=data.todos[a]._id,c=data.facebookId;data.todos.splice(a,1);var d=$(this);$.ajax({url:"/api?"+$.param({Id:b,FbId:c}),type:"DELETE",success:function(){d.fadeOut(500).remove()},error:function(){d.addClass("maybe")}})});